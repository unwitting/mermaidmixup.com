---
import marked from 'marked'

import PlainPage from '../layouts/PlainPage'
import { getActiveListings } from '../utils/etsy'

export async function createCollection() {
  console.log('Generating $listings collection')
  const listings = await getActiveListings();
  console.log(`Got ${listings.length} active listings from Etsy`)
  return {
    route: `/listings/:id`, // TODO slug
    paths() {
      return listings.map((listing) => ({
        params: { id: listing.listing_id },
      }));
    },
    async props({ params }) {
      return {
        listing: listings.find((listing) => listing.listing_id === params.id),
      };
    },
  };
};

const {listing} = Astro.props
const listingJSON = JSON.stringify(listing, null, 2)
---

<style lang="scss">
.header {
  padding: 2rem;
  border-bottom: 1px solid grey;
  font-size: 1.4rem;

  a {
    text-decoration: none;
    color: inherit;
  }
}

.listing-image-container {
  text-align: center;
  margin-top: 5rem;
  margin-bottom: 5rem;
}

.listing-image {
  width: 35rem;
  max-width: 100%;
  height: 35rem;
  max-height: 90vw;
  object-fit: cover;
  object-position: center;
  border-radius: 100%;
  border: 10px solid;
}

.container {
  max-width: 800px;
  margin: 0 auto 2rem auto;
  padding: 0 2rem;
}

.shop-link {
  display: inline-block;
  margin: 1rem auto;
  padding: 1rem;
  border: 1px solid grey;
  border-radius: 8px;
  text-decoration: none;
  color: inherit;
}
</style>

<PlainPage title={`${listing.title} | LGBTQ+ stickers and badges | MermaidMixup`}>
  <header class="header">
    <a href="/">MermaidMixup</a>
  </header>
  <main class="container">
    <div class="listing-image-container">
      <img class="listing-image" style={`border-color: #${listing.images[0].hex_code};`} src={listing.images[0].url_fullxfull} />
    </div>

    <h1>{listing.title}</h1>
    {marked(listing.description)}

    <a class="shop-link" href={listing.url}>Buy on Etsy</a>
  </main>

  <!-- <pre>{listingJSON}</pre> -->
</PlainPage>