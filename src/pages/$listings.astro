---
import marked from 'marked'

import PlainPage from '../layouts/PlainPage'
import ToolbarHeader from '../components/ToolbarHeader.astro'

import { activeListings } from '../utils/etsy'

export async function createCollection() {
  console.log('Generating $listings collection')

  activeListings.init()
  const listings = await activeListings.get()

  return {
    route: `/listings/:id`,
    paths() {
      return listings.map((listing) => ({
        params: { id: listing.listing_id },
      }));
    },
    async props({ params }) {
      return {
        listing: listings.find((listing) => listing.listing_id === params.id),
      };
    },
  };
};

const {listing} = Astro.props
const listingJSON = JSON.stringify(listing, null, 2)
---

<style lang="scss">
.listing-image-container {
  text-align: center;
  margin-top: 5rem;
  margin-bottom: 5rem;
}

.listing-image {
  width: 25rem;
  max-width: 100%;
  height: 25rem;
  max-height: 90vw;
  object-fit: cover;
  object-position: center;
  border-radius: 5rem;
  border: 5px solid;
}

.container {
  max-width: 800px;
  margin: 0 auto 2rem auto;
  padding: 0 2rem;
}

.heading {
  margin-bottom: 0.5rem;
}

.shop-link {
  display: inline-block;
  margin: 1rem auto;
  padding: 1rem;
  border: 1px solid grey;
  border-radius: 8px;
  text-decoration: none;
  color: inherit;

  transition: background-color 0.2s linear;

  &:hover {
    background-color: rgba(199, 206, 210, 0.3);
  }
}
</style>

<PlainPage title={`${listing.title} | LGBTQ+ stickers and badges | MermaidMixup`}>
  <ToolbarHeader />

  <main class="container">
    <div class="listing-image-container">
      <img class="listing-image" style={`border-color: #${listing.images[0].hex_code};`} src={listing.images[0].url_fullxfull} />
    </div>

    <h1 class="heading">{listing.title}</h1>
    <a class="shop-link" href={listing.url}>Buy on Etsy ({ listing.quantity } in stock)</a>
    {marked(listing.description)}
  </main>

  <!-- <pre>{listingJSON}</pre> -->
</PlainPage>